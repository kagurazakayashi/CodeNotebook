# 第1章 基础知识
- 汇编语言是直接在硬件之上工作的编程语言，首先要了解硬件系统的结构，才能有效的应用汇编语言对其编程。
- 在本章中，对硬件系统结构的问题进行一部分的探讨，以使后续的课程可在一个好的基础上进行。
- 汇编课程的研究重点放在如何利用硬件系统的编程结构和指令集有效灵活的控制系统进行工作。

## 1.1 机器语言
- 机器语言是机器指令的集合。
- 机器指令展开来讲就是一台机器可以正确执行的命令。
```
指令：01010000 (PUSH AX)
电平脉冲：
    ___     ___
___|   |___|   |_______________
 0   1   0   1   0   0   0   0
```
- 以后我们提到的计算机是指由CPU 和其他受CPU 直接或间接控制的芯片、器件、设备组成的计算机系统；
  - 比如我们最常见的PC 机。
- 程序员们将 0、1 数字编程的程序代码打在纸带或卡片上，1打孔，0不打孔，再将程序通过纸带机或卡片机输入计算机，进行运算。【二进制】
  - 示例: 应用8086CPU完成运算：`S = 768 + 12288 – 1280`
  - 机器码：
```
101100000000000000000011
000001010000000000110000
001011010000000000000101
```

## 1.2 汇编语言的产生
- 汇编语言的主体是汇编指令。
- 汇编指令和机器指令的差别在于指令的表示方法上。汇编指令是机器指令便于记忆的书写格式。
- 汇编指令是机器指令的助记符。
```
机器指令： 1000100111011000
操作：　　 寄存器BX的内容送到AX中
汇编指令： MOV AX,BX
```
- 这样的写法与人类语言接近，便于阅读和记忆。

**寄存器**
- 简单的讲是CPU中可以存储数据的器件，一个CPU中有多个寄存器。【CPU里的内存】
  - AX是其中一个寄存器的代号，
  - BX是另一个寄存器的代号。

- 计算机能读懂的只有机器指令，那么如何让计算机执行程序员用汇编指令编写的程序呢？
  - `程序员 -> 汇编指令(mov ax,bx...) -> 编译器 -> 机器码(1000100...) -> 计算机`

## 1.3 汇编语言的组成
1. 汇编指令（机器码的助记符）
2. 伪指令   （由编译器执行）
3. 其它符号（由编译器识别）
- 汇编语言的核心是汇编指令，它决定了汇编语言的特性。

## 1.4 存储器
- CPU 是计算机的核心部件．它控制整个计算机的运作并进行运算，要想让一个 CPU 工作，就必须向它提供指令和数据。
- 指令和数据在存储器中存放，也就是平时所说的内存。
- 在一台 PC 机中内存的作用仅次于 CPU 。
- 离开了内存，性能再好的 CPU 也无法工作。
- 磁盘不同于内存，磁盘上的数据或程序如果不读到内存中，就无法被 CPU 使用。

## 1.5 指令和数据
- 指令和数据是应用上的概念。
- 在内存或磁盘上，指令和数据没有任何区别，都是二进制信息。
- 同样一个二进制信息，表示数据或者程序是不同：
  - `1000100111011000` -> `89D8H`     (数据)
  - `1000100111011000` -> `MOV AX,BX` (程序)
  - 因此我们必须告诉电脑，对于一个二进制信息到底是数据还是程序。

## 1.6 存储单元
- 存储器被划分为若干个存储单元，每个存储单元从0开始顺序编号；
- 存储器不一定是内存，还包括显存。
- 例如：
  - 一个存储器有 128 个存储单元，
  - 编号从 0 ~ 127 ：
```
0   [   ]
1   [   ]
.........
126 [   ]
127 [   ]
```
- 对于大容量的存储器一般还用以下单位来计量容量（以下用 B 来代表 `Byte` ）：
  - `1 KB` = `1024 B ` 【2的10次方】
  - `1 MB` = `1024 KB`
  - `1 GB` = `1024 MB`
  - `1 TB` = `1024 GB`
  - `8 bit` = `1 byte`
- 磁盘的容量单位同内存的一样，实际上以上单位是微机中常用的计量单位。

## 1.7 CPU对存储器的读写
- CPU要想进行数据的读写，必须和外部器件（标准的说法是芯片）进行三类信息的交互：
  - 存储单元的地址（地址信息）
  - 器件的选择，读或写命令（控制信息）
  - 读或写的数据（数据信息）
- CPU是通过什么将地址、数据和控制信息传到存储芯片中的？
  - 电子计算机能处理、传输的信息都是电信号，电信号当然要用导线传送。
  - 在计算机中专门有连接CPU和其他芯片的导线，通常称为总线。
    - 物理上：一根根导线的集合；
    - 逻辑上划分为：
      - 地址总线
      - 数据总线
      - 控制总线
  - 总线在逻辑上划分的图示：
```
[ C ] -- 地址总线 -> [ R ]
[ P ] -- 数据总线 -> [ A ]
[ U ] -- 控制总线 -> [ M ]
```
- CPU从3号单元中读取数据的过程
- 读写操作流程：
```
CPU  　　　　　　　　　　　　内存
[  ]　　　　　　　　　　　　[12] 0
[  ]　　　　　　　　　　　　[3B] 1
[  ]地址线（　　３　》　　）[9C] 2
[  ]数据线（　　《　８　　）[08] 3
[  ]控制线（内存读写命令》）[31] 4
[  ]　　　　　　　　　　　　[23] 5
[  ]　　　　　　　　　　　　...
```
- 对于8086CPU，下面的机器码能够完成从3号单元读数据：
  - 机器码： `101000000000001100000000`
  - 含义：　 从3号单元读取数据送入寄存器AX
  - CPU 接收这条机器码后将完成上面所述的读写工作。
- 机器码难于记忆，用汇编指令来表示，情况如下：
  - 机器码：　　　　 `101000000000001100000000`
  - 对应的汇编指令： `MOV AX,[3]`
  - 含义：　　　　　 传送3号单元的内容到AX

## 1.8 地址总线
- CPU是通过地址总线来指定存储单元的。
- 地址总线上能传送多少个不同的信息，CPU就可以对多少个存储单元进行寻址。
- 32位，64位，寻址能力，相当于就是32根，64根线
- 64位，CPU+操作系统+软件均为64位
```
1011 [CPU]
  ^  [ 1 ][ 　 ]－－－－－－[ 　 ]
  |  [ 1 ][ 　 ]－－－－－－[ 　 ]
  |  [ 0 ][ 　 ]－－－－－－[ 　 ]
  |  [ 1 ][ 地 ]－－－－－－[ 　 ]
  |  [ 0 ][ 址 ]－－－－－－[ 内 ]
  |  [ 0 ][ 总 ]－－－－－－[ 　 ]
  |  [ 0 ][ 线 ]－－－－－－[ 　 ]
  |  [ 0 ][ 　 ]－－－－－－[ 　 ]
  |  [ 0 ][ 　 ]－－－－－－[ 　 ]
  |  [ 0 ][ 　 ]－－－－－－[ 存 ]
  |  [   ]  　  　　　　　  [ 　 ]
  |  [   ][ 　 数据总线 　 ][ 　 ]
  |  [   ]  　  　　　　　  [ 　 ]
  |  [   ][ 　 控制总线 　 ][ 　 ]
```
- 一个CPU有N根地址总线，则可以说这个CPU的地址总线的宽度为N。
- 这样的CPU最多可以寻找２的N次方个内存单元。
- 1个字节，8个位可以存放数据即有2的8次内存单元

## 1.9 数据总线
- CPU与内存或其它器件之间的数据传送是通过数据总线来进行的。
- 数据总线的宽度决定了CPU和外界的数据传送速度。
```
8位数据总线上传送的信息:
[   ][　   地址总线 　　][ 　 ]
[   ] 　   　　　　 　　 [ 　 ]
[   ][ 　 ]－－1－－0－－[ 　 ]
[   ][ 　 ]－－0－－0－－[ 　 ]
[ C ][ 数 ]－－0－－0－－[ 内 ]
[   ][ 据 ]－－1－－1－－[ 　 ]
[ P ][ 总 ]－－0－－1－－[ 　 ]
[   ][ 线 ]－－0－－0－－[ 　 ]
[ U ][ 　 ]－－0－－1－－[ 　 ]
[   ][ 　 ]－－1－－1－－[ 存 ]
[   ] 　第2次89  第1次D8[ 　 ]
[   ] 　   　　　　 　　 [ 　 ]
[   ][　   控制总线 　　][ 　 ]
[   ] 　   　　　　 　　 [ 　 ]
```
```
16位数据总线上传送的信息:
[   ][　 地址总线　][ 　 ]
[   ] 　   　　　　 [ 　 ]
[   ][ 　 ]－－1－－[ 　 ]
[   ][ 　 ]－－0－－[ 　 ]
[   ][ 数 ]－－0－－[ 　 ]
[   ][ 　 ]－－1－－[ 内 ]
[ C ][ 　 ]－－0－－[ 　 ]
[   ][ 据 ]－－0－－[ 　 ]
[   ][ 　 ]－－0－－[ 　 ]
[   ][ 　 ]－－1－－[ 　 ]
[ p ][ 总 ]－－0－－[ 　 ]
[   ][ 　 ]－－0－－[ 　 ]
[   ][ 　 ]－－0－－[ 　 ]
[   ][ 线 ]－－1－－[ 　 ]
[ U ][ 　 ]－－1－－[ 　 ]
[   ][ 　 ]－－0－－[ 存 ]
[   ][ 　 ]－－1－－[ 　 ]
[   ][ 　 ]－－1－－[ 　 ]
[   ] 　   　　　　 [ 　 ]
[   ][　 控制总线　][ 　 ]
[   ] 　   　　　　 [ 　 ]
```

## 1.10 控制总线
- CPU对外部器件的控制是通过控制总线来进行的。在这里控制总线是个总称，控制总线是一些不同控制线的集合。
- 有多少根控制总线，就意味着CPU提供了对外部器件的多少种控制。
- 所以，控制总线的宽度决定了CPU对外部器件的控制能力。
- 控制总线上发送的控制信息
```
[     ][　  地址总线　　][ 　 ]
[     ] 　  　　　　　　 [ 　 ]
[     ][　  数据总线　　][ 　 ]
[     ] 　  　　　　　　 [ 　 ]
[ C   ][ 　 ]－－－－－－[ 内 ]
[    1][ 　 ]－－－－－－[ 　 ]
[ P  1][ 　 ]－－－－－－[ 　 ]
[    0][ 控 ]－－－－－－[ 　 ]
[ U  1][ 制 ]－－－－－－[ 　 ]
[    0][ 总 ]－－－－－－[ 存 ]
[    0][ 线 ]－－－－－－[ 　 ]
[    0][ 　 ]－－－－－－[ 　 ]
[    0][ 　 ]－－－－－－[ 　 ]
[    0][ 　 ]－－－－－－[ 　 ]
[    0][ 　 ]－－－－－－[ 　 ]
```
- 前面所讲的内存读或写命令是由几根控制线综合发出的：
  - 其中有一根名为读信号输出控制线负责由CPU 向外传送读信号，CPU 向该控制线上输出低电平表示将要读取数据；
  - 有一根名为写信号输出控制线负责由CPU向外传送写信号。

## 1.1节~1.10节 小结

1. 汇编指令是机器指令的助记符，同机器指令一一对应。
2. 每一种CPU都有自己的汇编指令集。
3. CPU可以直接使用的信息在存储器中存放。
4. 在存储器中指令和数据没有任何区别，都是二进制信息。
5. 存储单元从零开始顺序编号。
6. 一个存储单元可以存储 8 个 bit （用作单位写成“b”），即 8 位二进制数。
7. 1B = 8b， 1KB = 1024B， 1MB = 1024KB， 1GB = 1024MB
8. 每一个CPU芯片都有许多管脚，这些管脚和总线相连。也可以说，这些管脚引出总线。一个CPU可以引出三种总线的宽度标志了这个CPU的不同方面的性能：
  - 地址总线的宽度决定了CPU的寻址能力；
  - 数据总线的宽度决定了CPU与其它器件进行数据传送时的一次数据传送量；
  - 控制总线宽度决定了CPU对系统中其它器件的控制能力。
- 我们从功能的角度介绍了这三类总线，对实际的连接情况不做讨论。

## 1.11 内存地址空间（概述）
- 什么是内存地址空间呢？
- 一个CPU的地址线宽度为10，那么可以寻址1024个内存单元，这1024个可寻到的内存单元就构成这个CPU的内存地址空间。下面深入讨论。
- 首先需要介绍两部分基本知识，主板和接口卡。

## 1.12 主板
- 在每一台PC机中，都有一个主板，主板上有核心器件和一些主要器件。
- 这些器件通过总线（地址总线、数据总线、控制总线）相连。

## 1.13 接口卡
- 计算机系统中，所有可用程序控制其工作的设备，必须受到CPU的控制。
- CPU对外部设备不能直接控制，如显示器、音箱、打印机等。直接控制这些设备进行工作的是插在扩展插槽上的接口卡。

## 1.14 各类存储器芯片
- 从读写属性上看分为两类：
  - 随机存储器（RAM）
  - 只读存储器（ROM）
    - 装有BIOS的ROM
      - BIOS：Basic Input/Output System，基本输入输出系统。
      - BIOS是由主板和各类接口卡（如：显卡、网卡等）厂商提供的软件系统，可以通过它利用该硬件设备进行最基本的输入输出。在主板和某些接口卡上插有存储相应BIOS的ROM。
- 从功能和连接上分类：
  - 随机存储器RAM
  - 装有BIOS的ROM
  - 接口卡上的RAM
- PC机中各类存储器的逻辑连接情况：

- CPU
  - 总线
    - RAM（主存储器）
    - ROM（装有系统BIOS）
    - 扩展插槽：RAM（主存储器）（内存条）
    - 扩展插槽：显卡
      - RAM（显存）
      - ROM（装有显卡BIOS）
      - ->显示器
    - 扩展插槽：网卡
      - ROM（装有网卡BIOS）
    - 其他器件

## 1.15 内存地址空间
- 上述的那些存储器在物理上是独立的器件。
- 但是它们在以下两点上相同：
  - 都和CPU的总线相连。
  - CPU对它们进行读或写的时候都通过控制线发出内存读写命令。
- 所有的物理存储器被看作一个由若干存储单元组成的逻辑存储器；
- 每个物理存储器在这个逻辑存储器中占有一个地址段，即一段地址空间；
- CPU在这段地址空间中读写数据，实际上就是在相对应的物理存储器中读写数据。

- CPU
  - 总线
    - 主存储器地址空间
      - RAM（主存储器）
      - 扩展插槽：RAM（主存储器）
    - 显存地址空间
      - 扩展插槽：显卡：RAM（显存）
    - 显卡 BIOS ROM 地址空间
      - 扩展插槽：显卡：ROM（装有显卡BIOS）
    - 网卡 BIOS ROM 地址空间
      - 扩展插槽：网卡：ROM（装有网卡BIOS）
    - 系统 BIOS ROM 地址空间
      - ROM（装有系统BIOS）
    - 其他器件

- 假设，上面的内存空间地址段分配如下：
  - 地址 `0~7FFFH    ` 的 `32 KB` 空间为主随机存储器的地址空间；
  - 地址 `8000H~9FFFH` 的 ` 8 KB` 空间为显存地址空间；
  - 地址 `A000H~FFFFH` 的 `24 KB` 空间为各个 ROM 的地址空间。

- 不同的计算机系统的内存地址空间分配情况是不同的。
- 8086PC机内存地址空间分配的基本情况:
```
00000 ===========
        主存储器
        地址空间
        （RAM）
9FFFF -----------
A0000 -----------
        显存地
        址空间
BFFFF -----------
C0000 -----------
        各类ROM
        地址空间
FFFFF ===========
```

- 内存地址空间：
  - 最终运行程序的是CPU，我们用汇编编程的时候，必须要从CPU角度考虑问题。
  - 对CPU来讲，系统中的所有存储器中的存储单元都处于一个统一的逻辑存储器中，它的容量受CPU寻址能力的限制。这个逻辑存储器即是我们所说的内存地址空间。